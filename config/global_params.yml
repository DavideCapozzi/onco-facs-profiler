# ==============================================================================
# PROJECT CONFIGURATION: CLR Network Inference
# ==============================================================================

# --- Setup ---
output_root: "results"
project_name: "longsurvivors"
input_file: "/mnt/c/Users/Davide/Desktop/Davide/bandi/0dottorato/projects/long survivors/DB_standardizzatov4_anonimo.xlsx"

# --- ANALYSIS TARGETS ---
# Define here exactly which groups form the analysis.
# Names must match the values in the 'stratification.column' (DATA$metadata$Original_Source).
control_group: "Healthy_Donors"
case_groups: ["HNSCC_EP", "NSCLC_EP", "NSCLC_LS", "HNSCC_LS"] 

# --- ANALYSIS SCENARIOS (Config-Driven Orchestration) ---
# Each item here triggers a full analysis cycle (Hypothesis -> Multivariate -> Network)
analysis_scenarios:
  - id: "01_Benchmark_Disease"
    description: "Characterizing the disease signature (All Cancer vs Healthy)"
    case_label: "Total_Cancer"
    case_groups: ["HNSCC_EP", "NSCLC_EP"]
    control_label: "Healthy_Ref"
    control_groups: ["Healthy_Donors"]
    
  - id: "02_Normalization_Check"
    description: "Checking if Long Survivors return to homeostasis"
    case_label: "Total_LS"
    case_groups: ["HNSCC_LS", "NSCLC_LS"]
    control_label: "Healthy_Ref"
    control_groups: ["Healthy_Donors"]
    
  - id: "03_Resistance_Mechanism"
    description: "Identifying resistance features (LS vs Progressors)"
    case_label: "Total_LS"
    case_groups: ["HNSCC_LS", "NSCLC_LS"]
    control_label: "Total_Cancer"
    control_groups: ["HNSCC_EP", "NSCLC_EP"]

# --- STRATIFICATION LOGIC ---
# "selection" mode simply promotes the target column to be the main grouping variable.
stratification:
  mode: "selection"             # Mode: direct selection from metadata
  column: "Original_Source"     # Metadata column containing the precise group names

# --- COHORTS MAPPING ---
cohorts:
  NSCLC: "NSCLC"
  HNSCC: "HNSCC"
  Healthy_Donors: "HD"

marker_selection:
  whitelist: []      
  blacklist: [] 

sample_selection:
  #blacklist: ["DS51.fcs"]
  blacklist: ["HD51"]  

hybrid_groups:
  Differentiation: []
  Lineage: []  
  Treg_Status: []
  
metadata:
  subgroup_col: "Original_Source"

# QC Reporting Configuration
qc_reporting:
  marker_categories:
    CD3_Lineage:
      - "CD3"
      - "CD3CM"
      - "CD3EFF"
      - "CD3EM"
      - "CD3NAIVE"
      - "CD3KI67"
      - "CD3KI67CM"
      - "CD3KI67EFF"
      - "CD3KI657EMRA"
      - "CD3KI67NAIVE"
    CD3_PD1_Complex: 
      - "CD3PD1"
      - "CD3PD1KI67"
      - "CD3PD1CM"
      - "CD3PD1EFF"
      - "CD3PD1EMRA"
      - "CD3PD1NAIVE"
    CD3_CD28_Complex:
      - "CD3CD28"
      - "CD3CD28KI67"
      - "CD3CD28CM"
      - "CD3CD28EFF"
      - "CD3CD28EMRA"
      - "CD3CD28NAIVE"
    CD3_CD137_Complex:
      - "CD3CD137"
      - "CD3CD137KI67"
      - "CD3CD137PD1"
      - "CD3CD137CM"
      - "CD3CD137EFF"
      - "CD3CD137EMRA"
      - "CD3CD137NAIVE"
    CD8_Lineage:
      - "CD8"
      - "CD8CD28"
      - "CD8CD137"
      - "CD8KI67"
      - "CD8PD1"
    CD4_Lineage:
      - "CD4"
      - "CD4CD28"
      - "CD4CD137"
      - "CD4KI67"
      - "CD4PD1"
    Tregs:
      - "TREG"
      - "RESTING"
      - "ACTIVE"
      - "NON-SUPPRESSIVE"
      - "TREGCD137"
    Myeloid_MDSC:
      - "M-MDSC"
      - "LOX1-PMN-MDSC"

# --- VISUALS & COLORS ---
colors:
  # Palette for generic case mapping if specific names are not found below
  control: "#2E8B57"        
  cases: ["#CD5C5C", "#4682B4", "#9932CC", "#FF8C00"] 

  # Specific color mapping for precise group names found in Original_Source
  groups:
    # Single groups
    NSCLC: "#CD5C5C"         
    HNSCC: "#4682B4"         
    Healthy_Donors: "#2E8B57" 
    
    # Multi-layer analyses
    Healthy_Ref: "#2E8B57"   
    Total_Cancer: "#CD5C5C"  
    Total_LS: "#FFD700"   

  highlight: "#FFD700"  

  heatmap:
    low: "#2166AC"    
    mid: "#F7F7F7"    
    high: "#B2182B"   
  
  plsda:
    positive: "#CD5C5C" 
    negative: "#4682B4" 
    
  distribution:
    mean: "darkred"
    median: "black"

viz:
  min_edge_weight: 0.15 
  heatmap_metadata: ["Group", "Original_Source"]
  merge_case_groups: false
  highlight_pattern: "_LS"

# --- Quality Control ---
qc:
  max_na_row_pct: 0.45   
  max_na_col_pct: 0.20  
  remove_outliers: true
  outlier_conf_level: 0.99

# --- Imputation (CoDa) ---
imputation:   
  epsilon: 0.000001

# --- Multivariate & Interpretation ---
multivariate:
  run_plsda: true
  n_comp: 2           
  validation_folds: 5 
  n_repeat_cv: 50
  top_n_loadings: 15  

# --- Inference Statistics ---
stats:
  seed: 2025
  min_sample_size: 4
  min_network_n: 3
  min_variance: 0.000001
  n_boot: 1000        
  n_perm: 2000        
  alpha: 0.05         
  fdr_threshold: 0.1 
  n_cores: "auto"

EOF: TRUE
